# Phase 2 & Phase 3 å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æœ¬æŠ¥å‘Šè®°å½•äº† M3E Reader UI Enhancement é¡¹ç›®ä¸­ **Phase 2ï¼ˆç¿»é¡µåŠ¨ç”»ç³»ç»Ÿï¼‰** å’Œ **Phase 3ï¼ˆM3E é£æ ¼ UI ç»„ä»¶ï¼‰** çš„å®Œæˆæƒ…å†µã€‚

å®Œæˆæ—¥æœŸï¼š2025å¹´

## âœ… Phase 2: ç¿»é¡µåŠ¨ç”»ç³»ç»Ÿå®ç°

### æ ¸å¿ƒæ¶æ„

#### 1. æ¥å£å’ŒåŸºç¡€ç±»
- **PageFlipAnimator.kt** - ç¿»é¡µåŠ¨ç”»å™¨æ¥å£
  - å®šä¹‰ç»Ÿä¸€çš„åŠ¨ç”»æ¥å£
  - æ”¯æŒæ‰‹åŠ¿è·Ÿéš
  - æä¾›åŠ¨ç”»ç”Ÿå‘½å‘¨æœŸç®¡ç†
  
- **PageFlipMode.kt** - ç¿»é¡µæ¨¡å¼æšä¸¾
  - 5ç§ç¿»é¡µæ¨¡å¼ï¼šSIMULATION, COVER, SLIDE, SCROLL, NONE
  - æä¾›æ˜¾ç¤ºåç§°å’Œæè¿°
  - æ”¯æŒå­—ç¬¦ä¸²è½¬æ¢
  
- **FlipDirection.kt** - ç¿»é¡µæ–¹å‘æšä¸¾ï¼ˆåœ¨ PageFlipAnimator.kt ä¸­å®šä¹‰ï¼‰
  - NEXTï¼ˆä¸‹ä¸€é¡µï¼‰
  - PREVIOUSï¼ˆä¸Šä¸€é¡µï¼‰
  
- **BasePageFlipAnimator.kt** - åŸºç¡€æŠ½è±¡åŠ¨ç”»å™¨
  - é€šç”¨çŠ¶æ€ç®¡ç†
  - è¿›åº¦è·Ÿè¸ª
  - ç”Ÿå‘½å‘¨æœŸå›è°ƒ

#### 2. åŠ¨ç”»ç®¡ç†å™¨
- **PageFlipAnimationManager.kt** - æ ¸å¿ƒç®¡ç†å™¨
  - åˆ›å»ºå’Œç®¡ç†ä¸åŒçš„åŠ¨ç”»å™¨
  - åè°ƒåŠ¨ç”»æ‰§è¡Œ
  - æ”¯æŒæ‰‹åŠ¿è·Ÿéšç¿»é¡µ
  - æä¾›å®Œæˆå’Œå›å¼¹åŠ¨ç”»

#### 3. ç¿»é¡µåŠ¨ç”»å®ç°

##### 3.1 æ»‘åŠ¨ç¿»é¡µï¼ˆSlidePageFlip.ktï¼‰
- æœ€ç®€å•çš„ç¿»é¡µæ•ˆæœ
- é¡µé¢å·¦å³å¹³ç§»åˆ‡æ¢
- æ€§èƒ½æœ€ä¼˜
- é€‚åˆä½ç«¯è®¾å¤‡

##### 3.2 è¦†ç›–ç¿»é¡µï¼ˆCoverPageFlip.ktï¼‰
- æ–°é¡µé¢ä»ä¾§é¢è¦†ç›–
- å¸¦é˜´å½±æ¸å˜æ•ˆæœ
- å¢å¼ºå±‚æ¬¡æ„Ÿ
- æ€§èƒ½é€‚ä¸­

##### 3.3 ä»¿çœŸç¿»é¡µï¼ˆSimulationPageFlip.ktï¼‰
- æ¨¡æ‹ŸçœŸå®ä¹¦ç±ç¿»é¡µ
- åŸºäº Legado æ ¸å¿ƒç®—æ³•
- åŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š
  - è´å¡å°”æ›²çº¿é¡µé¢å·æ›²
  - é€è§†å˜æ¢æ•ˆæœ
  - å¾„å‘é˜´å½±æ¸å˜
  - çº¿æ€§é«˜å…‰æ•ˆæœ
- æœ€çœŸå®ä½†æ€§èƒ½æ¶ˆè€—æœ€å¤§

##### 3.4 æ»šåŠ¨ç¿»é¡µï¼ˆScrollPageFlip.ktï¼‰
- å‚ç›´è¿ç»­æ»šåŠ¨
- é€‚åˆé•¿æ–‡æœ¬é˜…è¯»
- å¹³æ»‘æ»šåŠ¨ä½“éªŒ

##### 3.5 æ— åŠ¨ç”»æ¨¡å¼ï¼ˆNonePageFlip.ktï¼‰
- å³æ—¶åˆ‡æ¢é¡µé¢
- æ— ä»»ä½•åŠ¨ç”»æ•ˆæœ
- æ€§èƒ½æ¶ˆè€—æœ€å°

#### 4. Legado ç®—æ³•ç ”ç©¶
- **LegadoSimulationResearch.kt** - ç ”ç©¶æ–‡æ¡£
  - è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹è®¡ç®—
  - å·æ›²å˜æ¢çŸ©é˜µ
  - é˜´å½±æ¸å˜å‚æ•°
  - å…‰ç…§æ•ˆæœå‚æ•°

#### 5. æ‰‹åŠ¿å¤„ç†
- **PageGestureHandler.kt** - æ‰‹åŠ¿å¤„ç†å™¨
  - åŒºåˆ†ç‚¹å‡»å’Œæ‹–åŠ¨
  - è®¡ç®—æ‹–åŠ¨è¿›åº¦
  - åˆ¤æ–­å®Œæˆç¿»é¡µé˜ˆå€¼
  - å¤„ç†å–æ¶ˆå’Œå›å¼¹
  - è¾¹ç•Œæ£€æµ‹

### æŠ€æœ¯äº®ç‚¹

1. **ç­–ç•¥æ¨¡å¼æ¶æ„**
   - ç»Ÿä¸€æ¥å£ï¼Œä¸åŒå®ç°
   - æ˜“äºæ‰©å±•æ–°çš„ç¿»é¡µæ¨¡å¼
   - è¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢

2. **æ‰‹åŠ¿è·Ÿéš**
   - å®æ—¶è·Ÿéšè§¦æ‘¸ç‚¹
   - æµç•…çš„æ‹–åŠ¨ä½“éªŒ
   - æ™ºèƒ½å®Œæˆåˆ¤æ–­

3. **æ€§èƒ½ä¼˜åŒ–**
   - æä¾›å¤šç§æ€§èƒ½çº§åˆ«
   - æ”¯æŒé™çº§ç­–ç•¥
   - ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ

4. **å­¦ä¹  Legado**
   - æ·±å…¥ç ”ç©¶æ ¸å¿ƒç®—æ³•
   - è¯¦ç»†æ³¨é‡Šå’Œæ–‡æ¡£
   - å¯å¤ç”¨çš„ç ”ç©¶æˆæœ

## âœ… Phase 3: M3E é£æ ¼ UI ç»„ä»¶

### UI ç»„ä»¶å®ç°

#### 1. ReaderTopBar.kt - é¡¶éƒ¨å·¥å…·æ 
**åŠŸèƒ½ç‰¹æ€§ï¼š**
- æ˜¾ç¤ºä¹¦ç±æ ‡é¢˜å’Œç« èŠ‚ä¿¡æ¯
- ExpressiveIconButton è¿”å›æŒ‰é’®
- æ›´å¤šé€‰é¡¹èœå•æŒ‰é’®
- åŠé€æ˜æ¸å˜èƒŒæ™¯
- æ”¯æŒé•¿æ ‡é¢˜çœç•¥æ˜¾ç¤º

**è®¾è®¡è¦ç‚¹ï¼š**
- ä½¿ç”¨ M3 TopAppBar ç»„ä»¶
- æ¸å˜èƒŒæ™¯ä¸é®æŒ¡å†…å®¹
- è§¦è§‰åé¦ˆå¢å¼ºäº¤äº’
- å“åº”å¼å¸ƒå±€

#### 2. ReaderBottomBar.kt - åº•éƒ¨æ§åˆ¶æ 
**åŠŸèƒ½ç‰¹æ€§ï¼š**
- è¿›åº¦æ»‘å—ï¼ˆå¿«é€Ÿè·³è½¬ï¼‰
- ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®
- å®æ—¶é¡µç æ˜¾ç¤º
- åŠé€æ˜æ¸å˜èƒŒæ™¯
- ç¦ç”¨çŠ¶æ€å¤„ç†

**è®¾è®¡è¦ç‚¹ï¼š**
- ExpressiveIconButton æä¾›è§¦è§‰åé¦ˆ
- æ»‘å—æ”¯æŒç²¾ç¡®æ§åˆ¶
- æ¸…æ™°çš„è§†è§‰åé¦ˆ
- ä¼˜é›…çš„ç¦ç”¨çŠ¶æ€

#### 3. AnimatedToolbar.kt - å·¥å…·æ åŠ¨ç”»ç³»ç»Ÿ
**åŠŸèƒ½ç‰¹æ€§ï¼š**
- é¡¶éƒ¨å·¥å…·æ æ»‘å…¥/æ»‘å‡ºåŠ¨ç”»
- åº•éƒ¨å·¥å…·æ æ»‘å…¥/æ»‘å‡ºåŠ¨ç”»
- è‡ªåŠ¨éšè—è®¡æ—¶å™¨
- å·¥å…·æ å¯è§æ€§çŠ¶æ€ç®¡ç†

**åŠ¨ç”»è§„èŒƒï¼š**
- è¿›å…¥åŠ¨ç”»ï¼š400msï¼ŒEmphasizedDecelerate
- é€€å‡ºåŠ¨ç”»ï¼š200msï¼ŒEmphasizedAccelerate
- ä½¿ç”¨ M3E Emphasized Easing æ›²çº¿
- æ·¡å…¥æ·¡å‡ºé…åˆæ»‘åŠ¨

**çŠ¶æ€ç®¡ç†ï¼š**
- `ToolbarVisibilityState` ç±»
- `show()`, `hide()`, `toggle()` æ–¹æ³•
- è‡ªåŠ¨éšè—å»¶è¿Ÿé…ç½®

### M3E è®¾è®¡è§„èŒƒéµå¾ª

1. **Emphasized Easing æ›²çº¿**
   - EmphasizedDecelerate: (0.05, 0.7, 0.1, 1.0)
   - EmphasizedAccelerate: (0.3, 0.0, 0.8, 0.15)

2. **åŠ¨ç”»æ—¶é•¿**
   - è¿›å…¥ï¼š400msï¼ˆå¼ºè°ƒå‡é€Ÿï¼‰
   - é€€å‡ºï¼š200msï¼ˆå¼ºè°ƒåŠ é€Ÿï¼‰

3. **ç»„ä»¶ä½¿ç”¨**
   - ExpressiveIconButtonï¼ˆè§¦è§‰åé¦ˆï¼‰
   - Material3 TopAppBar
   - Material3 Slider

4. **è§†è§‰æ•ˆæœ**
   - åŠé€æ˜æ¸å˜èƒŒæ™¯
   - å±‚æ¬¡æ„Ÿé˜´å½±
   - æµç•…çš„åŠ¨ç”»è¿‡æ¸¡

## ğŸ“Š å®Œæˆç»Ÿè®¡

### Phase 2 ä»»åŠ¡å®Œæˆæƒ…å†µ
- âœ… ä»»åŠ¡ 5: åˆ›å»ºç¿»é¡µåŠ¨ç”»åŸºç¡€æ¶æ„
- âœ… ä»»åŠ¡ 6: å®ç°æ»‘åŠ¨ç¿»é¡µåŠ¨ç”»
- âœ… ä»»åŠ¡ 7: å®ç°è¦†ç›–ç¿»é¡µåŠ¨ç”»
- âœ… ä»»åŠ¡ 8.1: ç ”ç©¶ Legado çš„ SimulationPageDelegate
- âœ… ä»»åŠ¡ 8.2: å®ç°åŸºç¡€ä»¿çœŸç¿»é¡µ
- âœ… ä»»åŠ¡ 8.3: å®ç°å·æ›²é¡µé¢çš„èƒŒé¢å’Œæ­£é¢
- âœ… ä»»åŠ¡ 8.4: å®ç°é˜´å½±å’Œå…‰ç…§æ•ˆæœ
- âœ… ä»»åŠ¡ 9: å®ç°æ»šåŠ¨ç¿»é¡µåŠ¨ç”»
- âœ… ä»»åŠ¡ 10: å®ç°æ— åŠ¨ç”»æ¨¡å¼
- âœ… ä»»åŠ¡ 11: å®ç°æ‰‹åŠ¿è·Ÿéšå’Œæ‹–åŠ¨ç¿»é¡µ

**å®Œæˆç‡ï¼š100%ï¼ˆ10/10 ä»»åŠ¡ï¼‰**

### Phase 3 ä»»åŠ¡å®Œæˆæƒ…å†µ
- âœ… ä»»åŠ¡ 12: å®ç° ReaderTopBar
- âœ… ä»»åŠ¡ 13: å®ç° ReaderBottomBar
- âœ… ä»»åŠ¡ 14: å®ç°å·¥å…·æ æ˜¾ç¤º/éšè—åŠ¨ç”»
- â³ ä»»åŠ¡ 15: é›†æˆ QuickSettingsPanelï¼ˆå¾…å®Œæˆï¼‰
- â³ ä»»åŠ¡ 16: é›†æˆ ReadingSettingsDialogï¼ˆå¾…å®Œæˆï¼‰
- â³ ä»»åŠ¡ 17: å®ç°å¿«é€Ÿè®¾ç½® FABï¼ˆå¾…å®Œæˆï¼‰

**å®Œæˆç‡ï¼š50%ï¼ˆ3/6 ä»»åŠ¡ï¼‰**

## ğŸ“ æ–‡ä»¶æ¸…å•

### Phase 2 æ–‡ä»¶ï¼ˆ10ä¸ªï¼‰
```
app/src/main/java/takagi/ru/paysage/reader/animation/
â”œâ”€â”€ PageFlipAnimator.kt              # ç¿»é¡µåŠ¨ç”»å™¨æ¥å£
â”œâ”€â”€ PageFlipMode.kt                  # ç¿»é¡µæ¨¡å¼æšä¸¾
â”œâ”€â”€ PageFlipAnimationManager.kt     # åŠ¨ç”»ç®¡ç†å™¨
â”œâ”€â”€ BasePageFlipAnimator.kt         # åŸºç¡€æŠ½è±¡ç±»
â”œâ”€â”€ SlidePageFlip.kt                # æ»‘åŠ¨ç¿»é¡µ
â”œâ”€â”€ CoverPageFlip.kt                # è¦†ç›–ç¿»é¡µ
â”œâ”€â”€ SimulationPageFlip.kt           # ä»¿çœŸç¿»é¡µ
â”œâ”€â”€ ScrollPageFlip.kt               # æ»šåŠ¨ç¿»é¡µ
â”œâ”€â”€ NonePageFlip.kt                 # æ— åŠ¨ç”»æ¨¡å¼
â”œâ”€â”€ PageGestureHandler.kt           # æ‰‹åŠ¿å¤„ç†å™¨
â””â”€â”€ LegadoSimulationResearch.kt     # Legado ç®—æ³•ç ”ç©¶
```

### Phase 3 æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰
```
app/src/main/java/takagi/ru/paysage/ui/components/reader/
â”œâ”€â”€ ReaderTopBar.kt                 # é¡¶éƒ¨å·¥å…·æ 
â”œâ”€â”€ ReaderBottomBar.kt              # åº•éƒ¨æ§åˆ¶æ 
â””â”€â”€ AnimatedToolbar.kt              # å·¥å…·æ åŠ¨ç”»ç³»ç»Ÿ
```

## ğŸ¯ è´¨é‡ä¿è¯

### ä»£ç è´¨é‡
- âœ… è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
- âœ… æ¸…æ™°çš„æ¶æ„è®¾è®¡
- âœ… å¯å¤ç”¨çš„ç»„ä»¶
- âœ… æ— ç¼–è¯‘é”™è¯¯
- âœ… éµå¾ª Kotlin æœ€ä½³å®è·µ

### ç”¨æˆ·ä½“éªŒ
- âœ… æµç•…çš„åŠ¨ç”»æ•ˆæœ
- âœ… ç›´è§‚çš„äº¤äº’è®¾è®¡
- âœ… æ²‰æµ¸å¼é˜…è¯»ä½“éªŒ
- âœ… å“åº”å¼å¸ƒå±€æ”¯æŒ
- âœ… è§¦è§‰åé¦ˆå¢å¼º

### æ€§èƒ½è€ƒè™‘
- âœ… å¤šç§æ€§èƒ½çº§åˆ«
- âœ… é™çº§ç­–ç•¥æ”¯æŒ
- âœ… ç¡¬ä»¶åŠ é€Ÿä¼˜åŒ–
- âœ… å†…å­˜ç®¡ç†ä¼˜åŒ–

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

### Phase 3 å‰©ä½™ä»»åŠ¡
1. **ä»»åŠ¡ 15**: é›†æˆ QuickSettingsPanel
   - å¤ç”¨ç°æœ‰ç»„ä»¶
   - æ·»åŠ ç¿»é¡µæ¨¡å¼å¿«é€Ÿåˆ‡æ¢
   - å®ç°é¢æ¿å±•å¼€/æ”¶èµ·åŠ¨ç”»

2. **ä»»åŠ¡ 16**: é›†æˆ ReadingSettingsDialog
   - å¤ç”¨ç°æœ‰ç»„ä»¶
   - æ·»åŠ ç¿»é¡µæ¨¡å¼é€‰æ‹©æ ‡ç­¾é¡µ
   - æ·»åŠ è§¦æ‘¸åŒºåŸŸé…ç½®é€‰é¡¹

3. **ä»»åŠ¡ 17**: å®ç°å¿«é€Ÿè®¾ç½® FAB
   - ä½¿ç”¨ ExpressiveFAB ç»„ä»¶
   - å®ç° FAB æ˜¾ç¤º/éšè—åŠ¨ç”»

### Phase 4: é˜…è¯»å†…å®¹æ¸²æŸ“å’Œé¡µé¢ç®¡ç†
- å®ç° ReaderContent ç»„ä»¶
- å®ç°é¡µé¢æ•°æ®æ¨¡å‹
- å®ç°é¡µé¢é¢„æ¸²æŸ“ç³»ç»Ÿ
- å®ç°é¡µé¢æ¸²æŸ“å¼•æ“

## ğŸ“ æŠ€æœ¯æ–‡æ¡£

### ä½¿ç”¨ç¤ºä¾‹

#### 1. åˆ›å»ºç¿»é¡µåŠ¨ç”»ç®¡ç†å™¨
```kotlin
val scope = rememberCoroutineScope()
val animationManager = remember { PageFlipAnimationManager(scope) }

// è®¾ç½®ç¿»é¡µæ¨¡å¼
animationManager.setMode(PageFlipMode.SIMULATION)
```

#### 2. æ‰§è¡Œç¿»é¡µåŠ¨ç”»
```kotlin
animationManager.performFlip(
    direction = FlipDirection.NEXT,
    currentPage = currentPageBitmap,
    nextPage = nextPageBitmap,
    onProgress = { progress ->
        // æ›´æ–°è¿›åº¦
    },
    onComplete = {
        // ç¿»é¡µå®Œæˆ
    }
)
```

#### 3. æ‰‹åŠ¿è·Ÿéšç¿»é¡µ
```kotlin
// å¼€å§‹æ‹–åŠ¨
animationManager.startGestureFlip(
    direction = FlipDirection.NEXT,
    startOffset = touchPoint
)

// æ›´æ–°ä½ç½®
animationManager.updateGesturePosition(currentTouchPoint)

// å®Œæˆæˆ–å›å¼¹
animationManager.completeGestureFlip(
    shouldComplete = progress > 0.3f,
    onComplete = { /* å®Œæˆå›è°ƒ */ }
)
```

#### 4. ä½¿ç”¨åŠ¨ç”»å·¥å…·æ 
```kotlin
val toolbarState = rememberToolbarVisibilityState(
    initialVisible = false,
    autoHideDelay = 3000L
)

AnimatedToolbarLayout(
    visible = toolbarState.isVisible,
    autoHideDelay = toolbarState.autoHideDelay,
    onAutoHide = { toolbarState.hide() },
    topBar = {
        ReaderTopBar(
            bookTitle = "ä¹¦ç±æ ‡é¢˜",
            chapterTitle = "ç« èŠ‚æ ‡é¢˜",
            onNavigateBack = { /* è¿”å› */ },
            onMoreClick = { /* æ›´å¤š */ }
        )
    },
    bottomBar = {
        ReaderBottomBar(
            currentPage = 1,
            totalPages = 100,
            onPageChange = { /* è·³è½¬ */ },
            onPreviousPage = { /* ä¸Šä¸€é¡µ */ },
            onNextPage = { /* ä¸‹ä¸€é¡µ */ }
        )
    }
) {
    // é˜…è¯»å†…å®¹
}
```

## ğŸ‰ æ€»ç»“

Phase 2 å’Œ Phase 3 çš„æ ¸å¿ƒåŠŸèƒ½å·²ç»é«˜è´¨é‡å®Œæˆï¼

**ä¸»è¦æˆå°±ï¼š**
1. å®Œæ•´çš„ç¿»é¡µåŠ¨ç”»ç³»ç»Ÿï¼ˆ5ç§æ¨¡å¼ï¼‰
2. å­¦ä¹ å¹¶å®ç° Legado æ ¸å¿ƒç®—æ³•
3. å®Œå–„çš„æ‰‹åŠ¿è·Ÿéšå’Œæ‹–åŠ¨æ”¯æŒ
4. M3E é£æ ¼çš„ UI ç»„ä»¶
5. æµç•…çš„å·¥å…·æ åŠ¨ç”»ç³»ç»Ÿ

**ä»£ç è´¨é‡ï¼š**
- æ— ç¼–è¯‘é”™è¯¯
- è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
- æ¸…æ™°çš„æ¶æ„è®¾è®¡
- å¯å¤ç”¨çš„ç»„ä»¶

è¿™äº›ç»„ä»¶ä¸ºåç»­çš„é›†æˆå’Œä¼˜åŒ–æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ï¼
